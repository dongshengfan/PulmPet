<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>assets\scripts\components\boxes\box-samples\box.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-elements">Elements</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/CircularList.html">CircularList</a></li>
                                <li><a href="../classes/CircularListActionsAnimal.html">CircularListActionsAnimal</a></li>
                                <li><a href="../classes/List.html">List</a></li>
                                <li><a href="../classes/Play.html">Play</a></li>
                            </ul>
                
                                <ul id="api-elements" class="apis elements">
                                    <li><a href="../elements/{number}.html">&lt;{number}&gt;</a></li>
                                </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: assets\scripts\components\boxes\box-samples\box.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Enum состояний бокса
 * @typedef {Object} Movement
 * @property {number} toClose бокс закрыт.
 * @property {number} toOpen бокс открыт.
 */

/**
 * Состояние бокса (открыт/закрыт)
 * @type {Movement}
 */
const Movement = {
    toClose: 0,
    toOpen: 1,
};

/**
 * Enum состояний работы бокса
 * @typedef {Object} TypeBox
 * @property {number} bottom работа как нижний бокс.
 * @property {number} top работа как верхний бокс.
 * @property {number} right работа как правый бокс.
 * @property {number} left работа как левы бокс.
 */

/**
 * Тип бокса
 * @type {{bottom: number, top: number, right: number, left: number}}
 */
const TypeBox = {
    bottom: 0,
    top: 1,
    right: 2,
    left: 3,
};
/**
 * Ядро боксов
 * @type {cc.Class}
 */
var Box = cc.Class({
    extends: cc.Component,

    properties: {
        _startPos: null,//Стартовая позиция бокса
        _endPos: null,//конечная позиция бокса
        _type: null,//состояние типа бокса в котором он работает
        _direction: 1,//0- закрыться 1- открыться
        _flagBlock: false,//флаг блокировки
        _flagZaprosBlock: false,//флаг о необходиомсти блокировки
        _amountPix: null,//путь для бокса
        _actionMoveBox: null,//actions движения бокса

        timeBring: 0.01,//Время довода в секундах
        content: cc.Node,//контент над которым необходимо произвести работу
        opacityBox: 30,//Прозрачность бокса 
        indentLeft: 50,//Отступ слева (в px)
        indentRight: 50,//Отступ справа (в px)
    },

    /**
     * Осуществляет первоначальную настройку
     */
    onLoad() {
        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart.bind(this));
        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._getPermissionMove.bind(this));
        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd.bind(this));
    },

    start(){
        this._init();
    },

    /**
     * Инициализация переменных
     * @private
     */
    _init(){
        //Дальнейшее действие бокса
        this._direction = Movement.toOpen;
        this._settings();
    },

    /**
     * Действия на страт тача
     * @param {cc.Event} event
     */
    onTouchStart(event) {

    },

    /**
     * Действия на движение тача
     * @param {cc.Event} event событие
     */
    onTouchMove(event) {
        var delta = event.touch.getDelta();
        if (!this._flagBlock) {
            this._setMovement(delta)._moveBox(delta);
        }
    },

    /**
     * Действие на завершение тача
     * @param {cc.Event} event событие
     */
    onTouchEnd(event) {
        if (!this._flagBlock) {
            this._endSwipe();
        }
    },

    /**
     * Включает блокировку бокса
     */
    onBlock(){
        this._flagZaprosBlock = true;
        this._flagBlock = true;
    },

    /**
     * Выключает блокировку бокса
     */
    offBlock(){
        this._flagZaprosBlock = false;
        this._flagBlock = false;
    },

    /**
     * Открывает бокс
     */
    openBox(){
        this._direction = Movement.toOpen;
        this._endSwipe();
    },

    /**
     * Закрывает бокс
     */
    closeBox(){
        this._direction = Movement.toClose;
        this._endSwipe();
    },

    /**
     * Определяет ожидаемое состояние по направлению движения бокса
     * @param delta приращение
     * @returns {Box} этот класс
     * @private
     */
    _setMovement(delta) {
        if (this._type === TypeBox.top) {
            this._direction = delta.y &gt; 0 ? Movement.toClose : Movement.toOpen;
        } else if (this._type === TypeBox.bottom) {
            this._direction = delta.y &lt; 0 ? Movement.toClose : Movement.toOpen;
        } else if (this._type === TypeBox.left) {
            this._direction = delta.x &lt; 0 ? Movement.toClose : Movement.toOpen;
        } else {
            this._direction = delta.x &gt; 0 ? Movement.toClose : Movement.toOpen;
        }
        return this;
    },

    /**
     * Проверка на выход бокса за пределы интервала в резудьтате выполнения данного приращения. true-когда он не выходит
     * @param delta приращение координаты
     * @param start стартовая координа(координата закрытого бокса)
     * @param end конечная координата(координата открытого бокса)
     * @param current текущаа координата
     * @return {boolean} true- если бокс не выходит за пределы
     * @private
     */
    _isCheckOutOfRange(delta, start, end, current){
        return start &lt; end ? this._isOutOfRangeLeftBottom(delta, start, end, current) : this._isOutOfRangeRightTop(delta, start, end, current);
    },

    /**
     * Проверка на выход левого и нижнего бокса за пределы интервала в резудьтате выполнения данного приращения
     * @param delta приращение координаты
     * @param start стартовая координа(координата закрытого бокса)
     * @param end конечная координата(координата открытого бокса)
     * @param current текущаа координата
     * @returns {boolean} true- если бокс не выходит за пределы
     * @private
     */
    _isOutOfRangeLeftBottom(delta, start, end, current){
        return delta + current &gt; start &amp;&amp; delta + current &lt; end;
    },

    /**
     * Проверка на выход верхнего и правого бокса за пределы интервала в резудьтате выполнения данного приращения
     * @param delta приращение координаты
     * @param start стартовая координа(координата закрытого бокса)
     * @param end конечная координата(координата открытого бокса)
     * @param current текущаа координата
     * @returns {boolean} true- если бокс не выходит за пределы
     * @private
     */
    _isOutOfRangeRightTop(delta, start, end, current){
        return delta + current &lt; start &amp;&amp; delta + current &gt; end;
    },

    /**
     * Движение бокса
     * @param {cc.Vec2} delta приращение
     * @returns {Box}
     * @private
     */
    _moveBox(delta) {
        if (this._type === TypeBox.top || this._type === TypeBox.bottom) {
            (this._isCheckOutOfRange(delta.y, this._startPos.y, this._endPos.y, this.node.y)) ? this.node.y += delta.y : this._endSwipe();
        } else {
            (this._isCheckOutOfRange(delta.x, this._startPos.x, this._endPos.x, this.node.x)) ? this.node.x += delta.x : this._endSwipe();
        }
        return this;
    },

    /**
     * Выполняет авто доводку
     * @private
     */
    _endSwipe(){
        this._flagBlock = true;
        this._direction === Movement.toClose ? this._bring(this._startPos) : this._bring(this._endPos);
        this._refocus();
    },

    /**
     * Выполняет авто довод  бокса до финальной точки назначения
     * @param pos точка назначения
     * @private
     */
    _bring(pos){
        this._actionMoveBox = cc.moveTo(this.timeBring, pos);
        this.node.runAction(
            cc.sequence(this._actionMoveBox, cc.callFunc(this._finishBring, this))
        );
    },

    /**
     * Функция сигнализирующая о завершении доводки бокса
     * @private
     */
    _finishBring(){
        if (!this._flagZaprosBlock) this._flagBlock = false;
    },

    /**
     * Проверяет делает ли он это событие а не кто-то другой по ветке нодов до него
     * @param event событие
     * @private
     */
    _getPermissionMove(event) {
        if (event.target._name === this.node.name) {
            this.onTouchMove(event);
        }
    },

    /**
     * Возвращает размер бокса относительно пространства на стороне и условий отступов
     * @param {number} space  размер боксадо приращения
     * @returns {number} размер бокса
     * @private
     */
    _getSizeBox(space) {
        return space - this.indentLeft - this.indentRight;
    },

    /**
     * Меняет действие которое необходимо сделать дальше боксу(закрыться или открыться).Публикует событие
     * @private
     */
    _refocus() {
        if (this._direction === Movement.toClose) {
            this._direction = Movement.toOpen;
            this.publishEventClose();
        } else {
            this._direction = Movement.toClose;
            this.publishEventOpen();
        }
    },

    /**
     * Работа с прозрачностью бокса. Изменяет прозрачность бокса на основе положения его относительно начальных и конечных координат
     * @private
     */
    _opacityNode(currentPosBox) {
        let opasity = this.opacityBox + (((255 - this.opacityBox) * currentPosBox) / this._amountPix);
        if (opasity &gt; 255) {
            opasity = 255;
        } else if (opasity &lt; this.opacityBox) {
            opasity = this.opacityBox;
        }
        this.node.opacity = opasity;
    },
});

export { Box, Movement, TypeBox };
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
